#! /usr/bin/env ruby	
require File.join(File.dirname(__FILE__), '..', 'lib', 'ruby-fitbit')
require 'hirb'	

puts "ruby: 'ruby ruby-fitbit user@email.com pass'"
if(ARGV[0]!=nil && ARGV[1]!=nil)
  fitbit = RubyFitbit.new(ARGV[0],ARGV[1])

  #testing some in progress API methods
  fitbit.submit_food_log({:food => 'wrap', :unit => '1 serving'})
  #fitbit.get_food_items
  #puts fitbit.get_eaten_calories[:calories_xml]
  #exit 1

  begin
    date = Time.parse(ARGV[3])
  rescue
    date = Time.now
  end

  begin
    end_date = Time.parse(ARGV[4])
  rescue
    end_date = Time.now
  end
  
  data = fitbit.get_data(date)
  puts "Fitbit Data for #{date}"
  puts "Calories Burned #{data['calories']}"
  puts "Steps Taken #{data['steps']}"
  puts "Milkes Walked #{data['miles_walked']}"
  puts "Activity Levels Durations:"
  puts "Sedentary #{data['sedentary_active']}"
  puts "Lightly #{data['lightly_active']}"
  puts "Fairly # => #{data['fairly_active']}"
  puts "Very #{data['very_active']}"
end

if ARGV[2]!=nil

  case ARGV[2]
  when 'calorie'
    puts "calorie data for data #{date}"
    data = fitbit.get_calorie_data(date)
  when 'activity' 
    puts "calorie data for data #{date}"
    data = fitbit.get_activity_score_data(date)
  when 'summary'
    #do nothing just print the summary above
  else
    puts "steps data for data #{date}"
    data = fitbit.get_steps_data(date)
  end
  puts Hirb::Helpers::AutoTable.render(data)
end

if ARGV[4]!=nil
  puts "getting aggregated data"
  data = fitbit.get_aggregated_data(date, end_date) 
  puts Hirb::Helpers::AutoTable.render(data)
  puts "Average Data over that time"
  data = fitbit.get_avg_data(date, end_date) 
  puts Hirb::Helpers::AutoTable.render(data)
end

puts "done"
